<script src="sigma/src/sigma.core.js"></script>
<script src="sigma/src/conrad.js"></script>
<script src="sigma/src/utils/sigma.utils.js"></script>
<script src="sigma/src/utils/sigma.polyfills.js"></script>
<script src="sigma/src/sigma.settings.js"></script>
<script src="sigma/src/classes/sigma.classes.dispatcher.js"></script>
<script src="sigma/src/classes/sigma.classes.configurable.js"></script>
<script src="sigma/src/classes/sigma.classes.graph.js"></script>
<script src="sigma/src/classes/sigma.classes.camera.js"></script>
<script src="sigma/src/classes/sigma.classes.quad.js"></script>
<script src="sigma/src/classes/sigma.classes.edgequad.js"></script>
<script src="sigma/src/captors/sigma.captors.mouse.js"></script>
<script src="sigma/src/captors/sigma.captors.touch.js"></script>
<script src="sigma/src/renderers/sigma.renderers.canvas.js"></script>
<script src="sigma/src/renderers/sigma.renderers.webgl.js"></script>
<script src="sigma/src/renderers/sigma.renderers.svg.js"></script>
<script src="sigma/src/renderers/sigma.renderers.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.nodes.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.nodes.fast.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.fast.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.labels.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.hovers.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.nodes.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.curve.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.curvedArrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.curve.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.curvedArrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.extremities.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.utils.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.nodes.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.edges.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.edges.curve.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.labels.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.hovers.def.js"></script>
<script src="sigma/src/middlewares/sigma.middlewares.rescale.js"></script>
<script src="sigma/src/middlewares/sigma.middlewares.copy.js"></script>
<script src="sigma/src/misc/sigma.misc.animation.js"></script>
<script src="sigma/src/misc/sigma.misc.bindEvents.js"></script>
<script src="sigma/src/misc/sigma.misc.bindDOMEvents.js"></script>
<script src="sigma/src/misc/sigma.misc.drawHovers.js"></script>
<script src="sigma/src/utils/sigma.utils.js"></script>
<script src="sigma/src/utils/sigma.polyfills.js"></script>
<script src="sigma/src/sigma.settings.js"></script>
<script src="sigma/src/classes/sigma.classes.dispatcher.js"></script>
<script src="sigma/src/classes/sigma.classes.configurable.js"></script>
<script src="sigma/src/classes/sigma.classes.graph.js"></script>
<script src="sigma/src/classes/sigma.classes.camera.js"></script>
<script src="sigma/src/classes/sigma.classes.quad.js"></script>
<script src="sigma/src/classes/sigma.classes.edgequad.js"></script>
<script src="sigma/src/captors/sigma.captors.mouse.js"></script>
<script src="sigma/src/captors/sigma.captors.touch.js"></script>
<script src="sigma/src/renderers/sigma.renderers.canvas.js"></script>
<script src="sigma/src/renderers/sigma.renderers.webgl.js"></script>
<script src="sigma/src/renderers/sigma.renderers.svg.js"></script>
<script src="sigma/src/renderers/sigma.renderers.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.nodes.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.nodes.fast.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.fast.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.labels.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.hovers.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.nodes.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.curve.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.curvedArrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.curve.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.curvedArrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.extremities.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.utils.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.nodes.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.edges.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.edges.curve.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.labels.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.hovers.def.js"></script>
<script src="sigma/src/middlewares/sigma.middlewares.rescale.js"></script>
<script src="sigma/src/middlewares/sigma.middlewares.copy.js"></script>
<script src="sigma/src/misc/sigma.misc.animation.js"></script>
<script src="sigma/src/misc/sigma.misc.bindEvents.js"></script>
<script src="sigma/src/misc/sigma.misc.bindDOMEvents.js"></script>
<script src="sigma/src/misc/sigma.misc.drawHovers.js"></script>
<script src="sigma/plugins/sigma.plugins.dragNodes/sigma.plugins.dragNodes.js"></script>
<script src="sigma/plugins/sigma.layout.forceAtlas2/worker.js"></script>
<script src="sigma/plugins/sigma.layout.forceAtlas2/supervisor.js"></script>
<!-- END SIGMA IMPORTS -->
   <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <style>
     #header{
        width:100%;
        height:9%;
        background-color: #2A2A2A;
     }
     #graph-parent-container{
        width:79.2%;
        height:98.4%;
        position: absolute;
        background-color: #ccc;
     }
    #graph-container {
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      position: absolute;
    }
    h1 {
      font-size: 2vw;
   }
   h3 {
     font-size: 2.0vh;
   }
   p { 
     font-size: 1.5vmin;
     font-family: Georgia;
     color: white;
   }
    mydetails{
       width:20%;
       height:100%;
       float:right;
       background-color: #2A2A2A;
    }
    #chart-container{
        width:98%;
        height:45%;       
    }
    canvas {
       height: 20vw;
       width:33vw;
    }
    #title{
       text-align: center;
       font-weight: 800;
    }
    description{

       text-align: center;
       width:95%;
       height: 27%;
    }
  </style>
<html>
<head>
<style type="text/css">
  #container {
     height:100%;
     width:100%;
    margin: auto;
    background-color: black;
  }
</style>
</head>
<body onload="loadJSON();">   
   <div id="graph-parent-container">
<div id="graph-container"></div>
   </div>
<mydetails>
   <description>
      <p>Graph's Settings:</p>
      <hr/>
   <p>Choose number of displayed nodes:
   <select id="numberofnodes">
     <option value="200">200</option>
     <option value="400">400</option>
     <option value="600">600</option>
     <option value="800">800</option>
     <option value="1000">1000</option>
   </select>
    </p>
    <p>Choose max number of displayed Connections:
   <select id="connections">
   <option value="all">all</option>
  <option value="50">50</option>
  <option value="100">100</option>
   </select>
    </p>
    <p>
       <button onclick="loadJSON()">refresh graph</button>
    </p>
    </description>
   <hr/>
   <description>
      <p>Company's related Articles:</p>
      <hr/>
      <p style="font-size:12;">Select Article for more details:</p>
      <p>
      <select size="7" style="width: 17vw" id="articles"></select>
      </p>
      <p>
      
      <textarea id ="shortText" style="width: 17vw;  height: 17vw; text-align: justify;"></textarea>
      </p>
   </description>
</mydetails>
<script>
var numedges = 0;
function getText(){
   var e = document.getElementById("articles");
   var id1 = e.options[e.selectedIndex].value;
      $.ajax({
      type: "POST",
      url: "http://160.40.51.30:8082/HumanRightsCompanies/ArticleShort.php",
      dataType: 'json',
      data: { db: "WikiRate_NEW",
              collection: "HumanRights_publications",
              id: id1}            
      })
      .done(function( msg ) { 
         var el = document.getElementById("shortText");
         el.innerHTML = msg['Publication_title'] + "\n\n"+msg['Publication_text'];
      });
}

   function loadJSON(){
      
      $('#graph').remove(); 
      $('#graph-container').html('<div id="graph"></div>'); 
      document.getElementById("articles").innerHTML="";
      numedges = 0;
      var e = document.getElementById("numberofnodes");
      var nn = e.options[e.selectedIndex].value;
      var el = document.getElementById("connections");
      var nc = el.options[el.selectedIndex].value;
   $.ajax({
      type: "POST",
      url: "http://160.40.51.30:8082/HumanRightsCompanies/Nodes.php",
      dataType: 'json',
      data: { db: "Graphs",
              collection: "CompaniesNodes"}            
      })
      .done(function( msg ) {
         var  g = {
            nodes: [],
            edges: []
          };         
         var nodes = Object.keys(msg['nodes']).map(function(k) { return msg['nodes'][k]; });
         var ids = Object.keys(msg['nodes']).map(function(k) { return msg['nodes'][k]['id']; });
         ids = ids.slice(0,nn-1);
         for (i=0; i<nn; i++){
            g.nodes.push({
              id: nodes[i]['id'],
              label: nodes[i]['label'],
              x: nodes[i]['x'],
              y: nodes[i]['y'],
              size: nodes[i]['size'],
              color: "#00A67C"
            });
         }
         
         s = new sigma({ 
                  graph: g,
         container: 'graph-container',
         renderer: {
           // IMPORTANT:
           // This works only with the canvas renderer, so the
           // renderer type set as "canvas" is necessary here.
           container: 'graph-container',
           type: 'canvas'
         },
         settings:{
            minNodeSize: 0.5,
            maxNodeSize: 24,
            minEdgeSize: 0.1,
            maxEdgeSize: 2,
            defaultNodeBorderColor: '#000',
            borderSize: 2
         }
       });          
      var c = s.camera;

      sigma.plugins.dragNodes(s, s.renderers[0]);
      // Refresh the display:
      s.refresh();
      // ForceAtlas Layout
      s.startForceAtlas2(); 
      s.bind('clickNode', function(e) {
         document.getElementById("shortText").innerHTML = "";
         
        $.ajax({
            type: "POST",
            url: "http://160.40.51.30:8082/HumanRightsCompanies/Edges.php",
            dataType: 'json',
            data: { db: "Graphs",
                    collection: "CompaniesGraph",
                    id: e.data.node.id}            
            })
            .done(function( msg ) {
               var arr = Object.keys(msg).map(function(k) { return msg[k]; });
               for (i = 0; i<numedges; i++){s.graph.dropEdge('e'+i);}
               numedges = 0;
               if (nc!=="all"){
                  arr = arr.slice(0,nc-1);                  
               }
               s.stopForceAtlas2();
               for (i = 0; i<arr.length; i++){
                  if (ids.indexOf(msg[i]['id'])>-1 && msg[i]['id']!==e.data.node.id){
                     numedges++;
                     s.graph.addEdge({
                        id: 'e'+(numedges-1),
                        source: e.data.node.id,
                        target: msg[i]['id'],
                        size: msg[i]['weight'],
                        type: 'curve',
                        color: '#00A67C',
                        hover_color: '#000'
                        });
                     }                     
                  }
              
               
               select = document.getElementById('articles');
               
               $.ajax({
                   type: "POST",
                   url: "http://160.40.51.30:8082/HumanRightsCompanies/Articles.php",
                   dataType: 'json',
                   data: { db: "WikiRate_NEW",
                           collection: "HumanRights_publications",
                           id: e.data.node.id}            
                   })
                   .done(function( msg ) {
                      for (i = 0; i < select.options.length; i++) {
                        select.options[i] = null;
                     }
                      var arr = Object.keys(msg).map(function(k) { return msg[k]; });
                      for (var i = 0; i<arr.length; i++){
                        var opt = document.createElement('option');
                        opt.value = arr[i]['_id'];
                        opt.innerHTML = arr[i]['Publication_title'];
                        opt.setAttribute("onclick","getText();");
                        select.appendChild(opt);
                     }
                      
                   });               
               s.refresh();
               s.startForceAtlas2();
               for (var i = min; i<=max; i++){
                   var opt = document.createElement('option');
                   opt.value = i;
                   opt.innerHTML = i;
                   select.appendChild(opt);
               }
            });         
      });
   });
      
   

      
   }
</script>
</body>
</html>