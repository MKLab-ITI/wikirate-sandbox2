<script src="sigma/src/sigma.core.js"></script>
<script src="sigma/src/conrad.js"></script>
<script src="sigma/src/utils/sigma.utils.js"></script>
<script src="sigma/src/utils/sigma.polyfills.js"></script>
<script src="sigma/src/sigma.settings.js"></script>
<script src="sigma/src/classes/sigma.classes.dispatcher.js"></script>
<script src="sigma/src/classes/sigma.classes.configurable.js"></script>
<script src="sigma/src/classes/sigma.classes.graph.js"></script>
<script src="sigma/src/classes/sigma.classes.camera.js"></script>
<script src="sigma/src/classes/sigma.classes.quad.js"></script>
<script src="sigma/src/classes/sigma.classes.edgequad.js"></script>
<script src="sigma/src/captors/sigma.captors.mouse.js"></script>
<script src="sigma/src/captors/sigma.captors.touch.js"></script>
<script src="sigma/src/renderers/sigma.renderers.canvas.js"></script>
<script src="sigma/src/renderers/sigma.renderers.webgl.js"></script>
<script src="sigma/src/renderers/sigma.renderers.svg.js"></script>
<script src="sigma/src/renderers/sigma.renderers.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.nodes.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.nodes.fast.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.fast.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.labels.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.hovers.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.nodes.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.curve.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.curvedArrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.curve.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.curvedArrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.extremities.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.utils.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.nodes.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.edges.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.edges.curve.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.labels.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.hovers.def.js"></script>
<script src="sigma/src/middlewares/sigma.middlewares.rescale.js"></script>
<script src="sigma/src/middlewares/sigma.middlewares.copy.js"></script>
<script src="sigma/src/misc/sigma.misc.animation.js"></script>
<script src="sigma/src/misc/sigma.misc.bindEvents.js"></script>
<script src="sigma/src/misc/sigma.misc.bindDOMEvents.js"></script>
<script src="sigma/src/misc/sigma.misc.drawHovers.js"></script>
<script src="sigma/src/utils/sigma.utils.js"></script>
<script src="sigma/src/utils/sigma.polyfills.js"></script>
<script src="sigma/src/sigma.settings.js"></script>
<script src="sigma/src/classes/sigma.classes.dispatcher.js"></script>
<script src="sigma/src/classes/sigma.classes.configurable.js"></script>
<script src="sigma/src/classes/sigma.classes.graph.js"></script>
<script src="sigma/src/classes/sigma.classes.camera.js"></script>
<script src="sigma/src/classes/sigma.classes.quad.js"></script>
<script src="sigma/src/classes/sigma.classes.edgequad.js"></script>
<script src="sigma/src/captors/sigma.captors.mouse.js"></script>
<script src="sigma/src/captors/sigma.captors.touch.js"></script>
<script src="sigma/src/renderers/sigma.renderers.canvas.js"></script>
<script src="sigma/src/renderers/sigma.renderers.webgl.js"></script>
<script src="sigma/src/renderers/sigma.renderers.svg.js"></script>
<script src="sigma/src/renderers/sigma.renderers.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.nodes.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.nodes.fast.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.fast.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.labels.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.hovers.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.nodes.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.curve.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.curvedArrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.curve.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.curvedArrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.extremities.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.utils.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.nodes.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.edges.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.edges.curve.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.labels.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.hovers.def.js"></script>
<script src="sigma/src/middlewares/sigma.middlewares.rescale.js"></script>
<script src="sigma/src/middlewares/sigma.middlewares.copy.js"></script>
<script src="sigma/src/misc/sigma.misc.animation.js"></script>
<script src="sigma/src/misc/sigma.misc.bindEvents.js"></script>
<script src="sigma/src/misc/sigma.misc.bindDOMEvents.js"></script>
<script src="sigma/src/misc/sigma.misc.drawHovers.js"></script>
<script src="sigma/plugins/sigma.plugins.dragNodes/sigma.plugins.dragNodes.js"></script>
<script src="sigma/plugins/sigma.layout.forceAtlas2/worker.js"></script>
<script src="sigma/plugins/sigma.layout.forceAtlas2/supervisor.js"></script>
<!-- END SIGMA IMPORTS -->
   <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <style>
     #header{
        width:100%;
        height:9%;
        background-color: #2A2A2A;
     }
     #graph-parent-container{
        width:79.2%;
        height:98.4%;
        position: absolute;
        background-color: #ccc;
     }
    #graph-container {
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      position: absolute;
    }
    h1 {
      font-size: 2vw;
   }
   h3 {
     font-size: 2.0vh;
     color:white;
   }
   box {   
       float:left;
       text-align: center;
       width: 2vw;
       height: 1vw;
       margin: 0.1vw;
       border-width: 1px;
       border-style: solid;
       border-color: rgba(0,0,0,.2);
   }
   p { 
     font-size: 1.5vmin;
     font-family: Georgia;
     color: white;
            margin-left: 1vw;
       margin-right: 1vw;
   }
    mydetails{
       width:20%;
       height:100%;
       float:right;
       background-color: #2A2A2A;
    }
    #chart-container{
        width:98%;
        height:45%;       
    }
    canvas {
       height: 20vw;
       width:33vw;
    }
    #title{
       text-align: center;
       font-weight: 800;
    }
    description{

       text-align: left;
       width:95%;
       height: 27%;

    }
  </style>
<html>
<head>
<style type="text/css">
  #container {
     height:100%;
     width:100%;
    margin: auto;
    background-color: black;
  }
</style>
</head>
<body onload="loadJSON();">   
   <div id="graph-parent-container">
<div id="graph-container"></div>
   </div>
<mydetails>
   <description>
      <h3 style="text-align:center;">HumanRights Graph: A demonstration about the connections between Companies, Authors, Topics and Geographical Regions</h3>
   <hr/>
      <p style="text-align: justify; margin-left: 10px; margin-right: 10px;">
         Choose a node to see the most popular connections.
         
      </p>
   <hr/>
   </description>
   <description>
      <p>Meaning of Colors:</p>
      <hr/>
   
        <p><box style="background-color: #008880;"> </box> <text>  </text>Companies</p>
   <p><box style="background-color: #FF00FF;"> </box> <text>  </text>Authors</p>
   <p><box style="background-color: #00FF00;"> </box> <text>  </text>Regions / Countries</p>
   <p><box style="background-color: #FF0000;"> </box> <text>  </text>Topics</p> 
    
    <p>
       <button onclick="loadJSON()">refresh graph</button>
    </p>
    </description>
   <hr/>
</mydetails>
<script>
var numedges = 0;
var small = 0;

   function loadJSON(){
      small=0;
      $('#graph').remove(); 
      $('#graph-container').html('<div id="graph"></div>'); 
      numedges = 0;
   $.ajax({
      type: "POST",
      url: "http://160.40.51.30:8082/HumanRightsGraph/Nodes.php",
      dataType: 'json',
      data: { db: "Graphs",
              collection: "MultiNodes"}            
      })
      .done(function( msg ) {       
         var  g = {
            nodes: [],
            edges: []
          };         
         var nodes = Object.keys(msg['nodes']).map(function(k) { return msg['nodes'][k]; });
         var ids = Object.keys(msg['nodes']).map(function(k) { return msg['nodes'][k]['id']; });
         for (i=0; i<nodes.length; i++){
            
            g.nodes.push({
              id: nodes[i]['id'],
              label: nodes[i]['label'],
              x: nodes[i]['x'],
              y: nodes[i]['y'],
              size: nodes[i]['size'],
              color: nodes[i]['color']
              
            });
         }
         

         s = new sigma({ 
                  graph: g,
         container: 'graph-container',
         renderer: {
           // IMPORTANT:
           // This works only with the canvas renderer, so the
           // renderer type set as "canvas" is necessary here.
           container: 'graph-container',
           type: 'canvas'
         },
         settings:{
            minNodeSize: 2,
            maxNodeSize: 15,
            minEdgeSize: 0.1,
            maxEdgeSize: 2,
            defaultNodeBorderColor: '#000',
            borderSize: 2
         }
       });     
       
         s.graph.nodes().forEach(function(n) {
            n.originalColor = n.color;
         });       
      var c = s.camera;

      sigma.plugins.dragNodes(s, s.renderers[0]);
      // Refresh the display:
      s.refresh();
      // ForceAtlas Layout
      s.startForceAtlas2(); 
      s.bind('clickNode', function(e) {
         if (small===0){        
         $.ajax({
         type: "POST",
         url: "http://160.40.51.30:8082/HumanRightsGraph/MultiEdges.php",
         dataType: 'json',
         data: { db: "Graphs",
                 collection: "MultiEdges2",
                 id: e.data.node.id}            
         })
         .done(function( msg ) {  
            
         s.killForceAtlas2();
         var edges = Object.keys(msg).map(function(k) { return msg[k]; });
         var enodes = [];
        for (i = 0; i<numedges; i++){s.graph.dropEdge('e'+i);}
         numedges = 0;
         for (i = 0; i<edges.length; i++){
               
            if (ids.indexOf(edges[i]['target'])>-1 && msg[i]['id']!==e.data.node.id){
               enodes[numedges] = edges[i]['target'];      
               numedges++;      
               s.graph.addEdge({
                  id: 'e'+(numedges-1),
                  source: edges[i]['source'],
                  target: edges[i]['target'],
                  size: edges[i]['weight'],
                  type: 'curve',
                  color: '#696969',
                  hover_color: '#000'
                  });     
                  
            }
         }
         
         s.graph.nodes().forEach(function(n) {           
          if (enodes.indexOf(n.id)!==-1||e.data.node.id===n.id)            
            n.color = n.originalColor;
          else
            s.graph.dropNode(n.id);
        });
            s.refresh();
            s.startForceAtlas2({slowDown:2500});     
            small=1;
            
            }); }
               
            
         });  
      s.bind('clickStage', function(e) {
         loadJSON();
      });         
      }); 
   }
</script>
</body>
</html>