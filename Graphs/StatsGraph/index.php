
<script src="sigma/src/sigma.core.js"></script>
<script src="sigma/src/conrad.js"></script>
<script src="sigma/src/utils/sigma.utils.js"></script>
<script src="sigma/src/utils/sigma.polyfills.js"></script>
<script src="sigma/src/sigma.settings.js"></script>
<script src="sigma/src/classes/sigma.classes.dispatcher.js"></script>
<script src="sigma/src/classes/sigma.classes.configurable.js"></script>
<script src="sigma/src/classes/sigma.classes.graph.js"></script>
<script src="sigma/src/classes/sigma.classes.camera.js"></script>
<script src="sigma/src/classes/sigma.classes.quad.js"></script>
<script src="sigma/src/classes/sigma.classes.edgequad.js"></script>
<script src="sigma/src/captors/sigma.captors.mouse.js"></script>
<script src="sigma/src/captors/sigma.captors.touch.js"></script>
<script src="sigma/src/renderers/sigma.renderers.canvas.js"></script>
<script src="sigma/src/renderers/sigma.renderers.webgl.js"></script>
<script src="sigma/src/renderers/sigma.renderers.svg.js"></script>
<script src="sigma/src/renderers/sigma.renderers.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.nodes.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.nodes.fast.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.fast.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.labels.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.hovers.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.nodes.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.curve.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.curvedArrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.curve.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.curvedArrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.extremities.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.utils.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.nodes.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.edges.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.edges.curve.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.labels.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.hovers.def.js"></script>
<script src="sigma/src/middlewares/sigma.middlewares.rescale.js"></script>
<script src="sigma/src/middlewares/sigma.middlewares.copy.js"></script>
<script src="sigma/src/misc/sigma.misc.animation.js"></script>
<script src="sigma/src/misc/sigma.misc.bindEvents.js"></script>
<script src="sigma/src/misc/sigma.misc.bindDOMEvents.js"></script>
<script src="sigma/src/misc/sigma.misc.drawHovers.js"></script>
<script src="sigma/src/utils/sigma.utils.js"></script>
<script src="sigma/src/utils/sigma.polyfills.js"></script>
<script src="sigma/src/sigma.settings.js"></script>
<script src="sigma/src/classes/sigma.classes.dispatcher.js"></script>
<script src="sigma/src/classes/sigma.classes.configurable.js"></script>
<script src="sigma/src/classes/sigma.classes.graph.js"></script>
<script src="sigma/src/classes/sigma.classes.camera.js"></script>
<script src="sigma/src/classes/sigma.classes.quad.js"></script>
<script src="sigma/src/classes/sigma.classes.edgequad.js"></script>
<script src="sigma/src/captors/sigma.captors.mouse.js"></script>
<script src="sigma/src/captors/sigma.captors.touch.js"></script>
<script src="sigma/src/renderers/sigma.renderers.canvas.js"></script>
<script src="sigma/src/renderers/sigma.renderers.webgl.js"></script>
<script src="sigma/src/renderers/sigma.renderers.svg.js"></script>
<script src="sigma/src/renderers/sigma.renderers.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.nodes.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.nodes.fast.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.fast.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.labels.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.hovers.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.nodes.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.curve.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.curvedArrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.curve.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.curvedArrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.extremities.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.utils.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.nodes.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.edges.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.edges.curve.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.labels.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.hovers.def.js"></script>
<script src="sigma/src/middlewares/sigma.middlewares.rescale.js"></script>
<script src="sigma/src/middlewares/sigma.middlewares.copy.js"></script>
<script src="sigma/src/misc/sigma.misc.animation.js"></script>
<script src="sigma/src/misc/sigma.misc.bindEvents.js"></script>
<script src="sigma/src/misc/sigma.misc.bindDOMEvents.js"></script>
<script src="sigma/src/misc/sigma.misc.drawHovers.js"></script>
<script src="sigma/plugins/sigma.plugins.dragNodes/sigma.plugins.dragNodes.js"></script>
<!-- END SIGMA IMPORTS -->
<script src="sigma/plugins/sigma.parsers.gexf/gexf-parser.js"></script>
<script src="sigma/plugins/sigma.parsers.gexf/sigma.parsers.gexf.js"></script>
<script src="sigma/plugins/sigma.layout.forceAtlas2/worker.js"></script>
<script src="sigma/plugins/sigma.layout.forceAtlas2/supervisor.js"></script>
<script src="Chart/Chart.js"></script>
<script src="initializeArray.js"></script>
  <style>
     #header{
        width:100%;
        height:9%;
     }
     #graph-parent-container{
        width:70%;
        height:87%;
        position: absolute;
     }
    #graph-container {
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      position: absolute;
    }
    h1 {
      font-size: 2vw;
   }
   h3 {
     font-size: 2.0vh;
   }
   p {
     font-size: 1.5vmin;
   }
    mydetails{
       width:33%;
       height:89%;
       float:right;
    }
    #chart-container{
        width:98%;
        height:45%;       
    }
    canvas {
       height: 20vw;
       width:33vw;
    }
    #title{
       text-align: center;
       font-weight: 800;
    }
    description{
       text-align: justify;
       width:100%;
       height: 27%;
    }
  </style>
  <div id="header">
     <h1 align="center">Graph of overlapped companies per pair of sources</h1>
  </div>
  <div id="graph-parent-container">
     <div id="container">
  <div id="graph-container"></div>
</div>
  </div>
  <mydetails>
   <description>
      <h3>About the Graph: </h3>
     <p>This graph is a visualization of the overlapped companies between pairs
     of sources we've crawled in order to obtain useful insights about certain companies.
     The edges represents the existence of common companies in both sources. By selecting a node
     the top 5 sources in terms of the number of joint companies are highlighted and a chart is 
     displayed with the number of common companies between the selected source and the others. 
     Finally, by hovering on a node you can see the number of snippets and companies, 
     we obtained per source.</p>
      <hr/>
  </description>
    
  <div id="chart-container">
     
     <div id="title"></div>
<canvas id="canvas"></canvas>
  </div>
  </mydetails>
<div id="box"></div>
<script>
   var sources = initSources();
  // Add a method to the graph model that returns an
  // object with every neighbors of a node inside:
  sigma.classes.graph.addMethod('neighbors', function(nodeId) {
    var k,
        neighbors = {},
        index = this.allNeighborsIndex[nodeId] || {};

    for (k in index)
      neighbors[k] = this.nodesIndex[k];
   
    return neighbors;
    
  });
  
   var g = {
               nodes: [],
               edges: []
           };  
var mouse = {x: 0, y: 0};

document.addEventListener('mousemove', function(e){ 
    mouse.x = e.clientX || e.pageX; 
    mouse.y = e.clientY || e.pageY 
}, false);

  sigma.parsers.gexf('overlaps.gexf',
    {
   graph: g,
    container: 'graph-container',
    renderer: {
        container: document.getElementById('graph-container'),
        type: 'canvas'
    },
    settings: {
        minNodeSize: 8,
        maxNodeSize: 24,
         doubleClickEnabled: false,
         minEdgeSize: 0.2,
         maxEdgeSize: 8,
         enableEdgeHovering: true,
         edgeHoverColor: 'edge',
         defaultEdgeHoverColor: '#000',
         edgeHoverSizeRatio: 1,
         edgeHoverExtremities: true ,
         borderSize: 2
    }
    },
    function(s) {
           var i,j,
                    nodes = s.graph.nodes(),
                    len = nodes.length,
                    edges = s.graph.edges();
            for (i = 0; i < len; i++) {
                nodes[i].x = Math.cos(Math.PI * 2 * i / len);
                nodes[i].y = Math.sin(Math.PI * 2 * i / len);
                //nodes[i].size = 1602;//Math.random();//s.graph.degree(nodes[i].id);
                nodes[i].color = '#d03835';// + (Math.floor(Math.random() * 16777215).toString(16) + '000000').substr(0, 6);
            }
            for (i=0; i<edges.length; i++){
               edges[i].size = edges[i].weight;
               edges[i].type = 'curve';
            }           
            var c = s.camera;

            // Zoom out - single frame :
            c.goTo({
              ratio: c.ratio * c.settings('zoomingRatio')-0.3
            });
            //sigma.plugins.dragNodes(s, s.renderers[0]);
            // Refresh the display:
            s.refresh();
            // ForceAtlas Layout
            s.startForceAtlas2({worker: true, barnesHutOptimize: false, slowDown: 2500}); 
       
       
      s.bind('overNode',overNode);
      s.bind('outNode', outNode);     
      s.bind('overEdge', overEdge);
      s.bind('outEdge', outEdge);
      // We first need to save the original colors of our
      // nodes and edges, like this:
      s.graph.nodes().forEach(function(n) {
        n.originalColor = n.color;
      });
      var weights = new Array(len);
      for (i=0; i<len; i++){
         weights[i]= [];
         weights[i][i] = 0;
      }
      s.graph.edges().forEach(function(e) {
         weights[e.source][e.target] = e.weight;
         weights[e.target][e.source] = e.weight;
        e.originalColor = e.color;
      });
      var topClosestNeighbors = new Array(len);
      for (i=0; i<len; i++){
         var flag=0;
         topClosestNeighbors[i] = new Array(5);
         for (j=0; j<5; j++){
               var index = findMax(weights[i]);
               topClosestNeighbors[i][j]=index;
               weights[i][index]=-1;
         }
      }      
      // When a node is clicked, we check for each node
      // if it is a neighbor of the clicked one. If not,
      // we set its color as grey, and else, it takes its
      // original color.
      // We do the same for the edges, and we only keep
      // edges that have both extremities colored.
      s.bind('clickNode', function(e) {
        var nodeId = e.data.node.id;
        s.graph.nodes().forEach(function(n) {           
          if (topClosestNeighbors[nodeId].indexOf(parseInt(n.id))!==-1||nodeId===n.id)
            n.color = n.originalColor;
          else
            n.color = '#eee';
        });

        s.graph.edges().forEach(function(e) {
          if ((e.source===nodeId&&topClosestNeighbors[nodeId].indexOf(parseInt(e.target))!==-1)||
                  (e.target===nodeId&&topClosestNeighbors[nodeId].indexOf(parseInt(e.source))!==-1))
            e.color = e.originalColor;
          else
            e.color = '#eee';
        });
        
        title.innerHTML = e.data.node.label;
         chart_container.style.display = 'block'; 
         
         ctx = document.getElementById("canvas").getContext("2d");
         linechart = new Chart(ctx).Line(getDataLine(ChartData[nodeId],ChartLabels[nodeId]), {
         responsive: true,
         scaleShowGridLines : false         
         });   
         linechart.destroy();
         //linechart.destroy();
        // Since the data has been modified, we need to
        // call the refresh method to make the colors
        // update effective.
        s.refresh();
      });

      // When the stage is clicked, we just color each
      // node and edge with its original color.
      s.bind('clickStage', function(e) {
        chart_container.style.display = 'none';
        s.graph.nodes().forEach(function(n) {
          n.color = n.originalColor;
        });

        s.graph.edges().forEach(function(e) {
          e.color = e.originalColor;
        });

        // Same as in the previous event:
        s.refresh();
      });
    }
  );
var ctx = document.getElementById("canvas").getContext("2d");
var linechart;
var title = document.getElementById("title");
var box = document.getElementById("box");
var chart_container = document.getElementById("chart-container");
var ChartLabels = initLabels();
var ChartData = initData();
function overNode(event) {
   box.style.display = 'block';
   box.style.position = 'fixed';
   box.style.left = mouse.x+20+'px';
   box.style.top = mouse.y+20+'px';
   box.style.background = 'white';
   box.innerHTML= sources[event.data.node.id][0]+"<br/>"
                              +"<b>Snippets:</b> "+sources[event.data.node.id][1]+"<br\>"
                              +"<b>Companies:</b> "+sources[event.data.node.id][2]+"<br\>";

} 


function outNode(event) {
   box.style.display = 'none';
} 

function overEdge(event) {
} 

function outEdge(event) {

} 

function findMax(arr){
   var max = arr[0];
   var maxIndex = 0;

   for (var i = 1; i < arr.length; i++) {
       if (arr[i] > max) {
           maxIndex = i;
           max = arr[i];
       }
   }
   return maxIndex;
}
</script>